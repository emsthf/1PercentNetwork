
### 광섬유 FTTH

`광섬유`는 이중 구조로 제조된 가는 섬유질의 투명한 재질(유리나 플라스틱)로 만들어져 있으며 안쪽에 있는 코어 부분에 광신호를 흘려서 디지털 데이터를 전달합니다.  <br/>
등이 켜진 밝은 상태가 1, 어두운 상태가 0입니다.<br/>
<br/>
디지털 데이터를 전압이나 전류로 바꾸고 이것을 `LED`나 `레이저 다이오드`로 만든 `광원`에 입력하면 전압이나 전류의 세기에 따라 광원이 발광하여 `빛의 명암`으로 정보를 전달합니다.<br/>
<br/>
이 빛의 명암은 광섬유를 통과하여 수신측에 있는 수광 소자에 도착하는데, 빛을 감응하는 `포토 다이오드`에서 빛을 받아 빛의 명암에 따라 전압이나 전류를 생성시키고 이를 디지털 신호로 바꾸는 방식입니다.<br/>
<br/>
광섬유를 이용한 통신의 요점은 빛을 전달하는 광섬유에 있는데요. 투명한 재질의 섬유 속을 빛이 통과한다는 부분은 직관적이지만 재질 차이로 생기는 빛의 투과율이나 굴절률 차이, 코어의 직경 등 생각보다 복잡합니다.<br/>
<br/>
광원에서 출발한 빛은 입사각이 작은 것은 `코어` 내부로 들어와 경계면에 `전반사`되어 코어 속을 지나가고 다른 것은 굴절되어 `클래드`를 투과해 나갑니다.<br/>
<br/>
이때 입사각이 작은 빛 중에서도 코어와 클래드의 경계면에서 반사할 때 각도에 따라 `위상차`가 생겨 도중에 소멸하기도 합니다.  <br/>
일부 위상차가 발생하지 않는 특정 각도의 빛만이 끝까지 살아남아 전달되는데, 이 각도를 고려해 코어의 직경이 결정됩니다.<br/>
<br/>
이처럼 코어의 직경이 중요해서 8~10 마이크로미터 정도의 코어 굵기를 갖는 `싱글모드`와 50 ~ 62.5 마이크로미터 정도의 굵기를 갖는 `멀티모드`로 분류됩니다.<br/>
<br/>
`싱글 모드`는 코어가 가늘고 입사각이 작은 빛만 진행되기에 위상이 같은 각도 중 가장 작은 각도의 빛만 코어 속으로 들어갈 수 있습니다.<br/>
<br/>
반대로 `멀티 모드`는 코어의 직경이 굵고 입사각이 큰 빛도 코어 내로 들어가기 때문에 위상이 같은 각도 중에서도 가장 작은 각도뿐 아니라 여러 각도의 빛이 동시에 진행합니다.  <br/>
즉, 싱글과 멀티는 같은 위상의 빛의 각도가 몇 개인지를 나타냅니다.<br/>
<br/>
`멀티 모드`에서는 코어 내에 여러 반사각의 빛이 동시에 진행되기 때문에 빛이 많아 광원이나 수광 소자의 성능이 비교적 낮아도 괜찮습니다.  <br/>
하지만 반사각이 큰 빛은 광섬유를 진행하는 동안 여러 번 반사가 되고 반사각이 작은 빛은 적은 반사 횟수로 더 빠르게 수신 측에 도착하므로 신호의 폭이 길어져 신호가 변형되는데 이 것이 허용 한도를 초과하면 통신 오류를 일으킵니다.<br/>
<br/>
`싱글 모드`는 코어를 진행하는 빛이 하나이기 때문에 광원과 수광 소자의 성능이 중요한 대신 이러한 문제가 발생하지 않습니다.<br/>
<br/>
이런 차이 때문에 광섬유의 최대 길이는 싱글 모드가 멀티 모드에 비해 신호의 변형이 적으므로 케이블 길이를 길게 할 수 있습니다.<br/>
<br/>
따라서 멀티 모드는 주로 한 건물 안을 연결하는 용도로 사용하고 싱글 모드는 멀리 떨어진 장소를 연결할 때 사용합니다.  <br/>
앞으로 설명할 `FTTH`는 싱글모드를 사용합니다.  <br/>
  
<br/>

---

<br/>

#### FTTx(Fiber to the x)

**Fiber to _x_** ( **FTTX** , "fibre"라고도 함) 또는 **Fiber in the Loop는** [최종 마일](https://en.wikipedia.org/wiki/Last_mile_(telecommunications) "라스트 마일(통신)") [통신에](https://en.wikipedia.org/wiki/Telecommunication "통신") 사용되는 [로컬 루프의](https://en.wikipedia.org/wiki/Local_loop "로컬 루프") 전체 또는 일부를 제공하기 위해 [광섬유를 사용하는 모든](https://en.wikipedia.org/wiki/Optical_fiber "광섬유") [광대역](https://en.wikipedia.org/wiki/Broadband "광대역") 네트워크 아키텍처에 대한 일반적인 용어입니다. <br/>
광섬유 케이블은 특히 장거리에서 구리 케이블보다 훨씬 많은 데이터를 전송할 수 있기 때문에 20세기에 구축된 구리 전화 네트워크는 광섬유로 대체되고 있습니다.

![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/FTTX.svg/300px-FTTX.svg.png)

> 광섬유와 [최종 사용자 사이의 거리에](https://en.wikipedia.org/wiki/End_user "최종 사용자") **따라** FTT **X** ( **노드** , 도시, 건물 , 홈) 아키텍처가 **어떻게** **다른지** 보여주는 개략도입니다. 왼쪽에 있는 건물은 [중앙 사무실](https://en.wikipedia.org/wiki/Telephone_exchange "전화 교환") 입니다 .<br/>
> 오른쪽 건물은 중앙청에서 근무하는 건물 중 하나입니다. 점선 직사각형은 동일한 건물 내의 별도의 생활 또는 사무실 공간을 나타냅니다.  
>   

<br/>

---

<br/>

### FTTH 액세스 회선

`FTTH 액세스 회선`은 `광섬유`를 사용해 사용자 측의 `인터넷 접속용 라우터`와 인터넷 측의 `BAS`를 접속하는 것을 의미합니다.<br/>
<br/>
이 형태는 크게 두 가지로 나눌 수 있는데요.  <br/>
한 가지 형태는 한 개의 광섬유로 사용자 측과 가장 가까운 전화국 측을 접속하게 하는 유형입니다.  <br/>
이 유형은 사용자와 전화국 사이를 `한 개의 광섬유로 직접 연결`합니다.  <br/>
또 다른 형태는 사용자 부근의 전주에 `광스플리터`라는 `분기 장치`를 설치하고 여기에서 광섬유를 분기시켜 복수의 사용자를 연결하는 유형입니다.  
각 유형에 대한 자세한 설명을 하겠습니다.<br/>
<br/>

##### 직접 연결하는 유형

광섬유를 직접 연결하는 유형은 사용자 측에 설치된 `미디어 컨버터`라는 장치에서 이더넷의 패킷(전기 신호)을 패킷으로 변환만 합니다.  <br/>
변환된 광신호는 광섬유 속으로 들어가는데 `BAS` 바로 앞에 있는 `집합형의 미디어 컨버터`에 연결되어 전기 신호로 복원됩니다.  <br/>
복원된 신호는 BAS의 포트가 수신하여 인터넷의 내부로 패킷을 중계합니다.<br/>
<br/>
이렇게 패킷을 인터넷에 보내면 응답 패킷이 돌아오고 이를 다시 광신호로 변환하여 보내는데, 이때 송, 수신(상, 하향) 신호가 혼합됩니다.  <br/>
파장이 다른 빛은 혼합되어도 프리즘의 원리로 분리할 수 있으므로 혼합되어도 문제가 되지 않는데, 이렇게 한 개의 광섬유로 파장이 서로 다른 복수의 광신호를 흘리는 것을 `파장 다중`이라 부릅니다.  <br/>
  <br/>

##### 분기하는 유형

광 스플리터를 이용해 분기하는 경우는 `미디어 컨버터` 대신 `ONU(Optical Network Unit)`란 장치를 사용자 측에 설치하고 이더넷 신호를 광신호로 변환하며 이 신호는 `BAS` 바로 앞의 `OLT(Optical Line Terminal)`란 장치로 들어가는 형태입니다.  <br/>
광신호가 흐르는 방향은 앞선 방법과 동일하지만 복수의 사용자가 동시에 패킷 송신 동작을 사용하면 `광스플리터` 부분에서 패킷의 광신호가 충돌한다는 점이 다릅니다.  <br/>
따라서 `OLT`와 `OMU`에는 `패킷 충돌 방지`를 위한 타이밍 조정 기능이 마련되어 있습니다.<br/>
<br/>
이 기능은 `OLT`가 송신 타이밍을 조정하여 `ONU`에 송신 지시를 내리고 그 지시에 따라 `ONU`가 송신 동작을 실행하는 형태로 작동합니다.  <br/>
그리고 이때 `ONU`를 식별하는 부가 정보를 패킷의 맨 앞 부분에 추가하여 자신에게 오는 신호인 경우에만 광신호를 수신하여 이더넷의 전기 신호로 변환합니다.  <br/>
마치 MAC 주소를 이용한 패킷 전송 방식처럼요.  <br/>
  <br/>

---

<br/>


#### ADSL 생략으로 인한 용어 설명

##### BAS

`BroadBand Access Server`, 패킷 중계 장치로 라우터의 일종  <br/>
BAS은 수신한 패킷에서 MAC 헤더와 `PPPoE(Point-to-Point Protocol over Ethernet)` 헤더를 버리고 PPP 헤더 이후의 부분을 추출하고 터널링용 헤더를 붙여 터널링의 출구를 향해 중계합니다.<br/>

#### PPP

`Point - to - Point Protocol`, `전화 회선`이나 `ISDN(Integrated Service Digital Network)` 등의 통신 회선을 사용하여 통신할 때 사용하는 구조.  <br/>
본인 확인, 설정 값 통지, 데이터 압축, 암호화 등 다양한 기능을 조합하여 사용할 수 있음
<br/>

#### PPPoE(Point-to-Point Protocol over Ethernet)

`PPP`를 `HDLC(High-level Data Link Control)` 대신 `이더넷 패킷`을 이용해 사용하기 위해 고안된 사양

<br/>

---

<br/>

### 액세스 회선으로 이용하는 PPP와 터널링

`ADSL`이나 `FTTH` 등의 액세스 회선에서 인터넷을 향해 흘러온 패킷은 액세스 회선을 운영하는 사업자가 소유한 `BAS`에 도착합니다.<br/>
<br/>
인터넷은 원래 다수의 라우터를 함께 연결하여 만든 것이므로 액세스 회선을 라우터에 연결하는 것이 원칙입니다.  <br/>
그리고 액세스 회선이 `ADSL`이나 `FTTH`로 발전한 것이므로 이것에 맞게 액세스 회선을 연결하는 라우터 역시 발전했는데 이것이 바로 `BAS`입니다.<br/>
<br/>
BAS에서 발전한 것이 바로 본인 확인과 설정 값 통지 기능입니다. <br/>
`ADSL`이나 `FTTH`의 액세스 회선은 최초에 사용자명과 패스워드를 입력하여 로그인 동작을 실행하지 않으면 인터넷에 액세스 할 수 없습니다.  <br/>
이때 `BAS`는 로그인 동작의 창구 역할이 됩니다. 이를 위해 `PPPoE`라는 구조를 사용하는데 보통의 전화 회선을 이용한 `다이얼업 접속`으로 이용하는 `PPP` 구조를 발전시킨 것으로, `PPP`에 대한 설명을 먼저 하겠습니다.  <br/>
  
<br/>

---

<br/>


#### PPP

`PPP`는 먼저 프로바이더의 액세스 포인트에 전화를 걸고 전화가 연결되면 사용자 명과 패스워드를 입력하여 로그인 조작을 합니다.  <br/>
이 사용자 명과 패스워드는 `RADIUS(Remote Authentication Dial-in User Service)`라는 프로토콜을 사용하여 `RAS(Remote Access Server)`에서 본인 확인 용 서버(인증 서버)에 전송되어 검증합니다.<br/>
<br/>
인증이 완료되면 IP 주소 등의 설정 정보가 인증 서버로부터 반송되어 사용자 측에 전달합니다.  <br/>
사용자의 PC는 이 정보에 따라 IP 주소 등을 설정하며, TCP/IP 패킷을 송수신할 준비가 됩니다.<br/>
<br/>
이 동작에서 중요한 점은 TCP/IP 설정 정보를 통지하는 동작에 있습니다.  <br/>
인터넷에 접속할 때는 PC에 글로벌 주소를 설정해야 하는데, `다이얼 업 접속`은 전화번호에 따라 액세스 포인트를 전환할 수 있고, 전환한 액세스 포인트에 따라 주소가 달라지므로 사전에 고정된 값으로 PC 주소를 설정 할 수 없습니다.  <br/>
때문에 인터넷에 접속 할 때 위와 같은 단계를 거치게 됩니다.  <br/>
  
<br/>

---

<br/>

#### PPPoE

`ADSL`이나 `FTTH`도 `PC에 글로벌 주소`를 설정하지 않으면 인터넷에 접속 할 수 없는 것은 동일합니다. 하지만 사용자와 `BAS`를 케이블로 고정적으로 접속하므로 본인 확인을 할 필요가 없습니다.  <br/>
하지만 사용자에 따른 프로바이더 전환의 편의 목적으로 액세스 회선의 사용자는 `PPP` 구조를 동일하게 사용하기로 했습니다.<br/>
<br/>
`PPP`에는 신호에 대한 규정이 없으므로 그대로 신호로 변환하여 송신할 수 없습니다. <br/>
때문에 PPP 메시지를 작성하여 이를 옮겨주는 그릇이 필요한데, 이를 `HDLC`라는 프로토콜의 사양을 차용하기로 했습니다.  <br/>
HDLC는 원래 전용 통신 회선을 사용하여 패킷을 운반하기 위해 만들어졌기에 다이얼업 접속에서는 일부 수정하여 사용합니다.<br/>
<br/>
ADSL이나 FTTH에서도 HDLC를 사용할 수 있는 형태라면 그대로 PPP를 사용할 수 있겠지만, 사양이 달라 이를 대신할 목적으로 이더넷의 패킷을 사용하기로 했고, 이를 위한 새로운 사양인 `PPPoE`가 개발되었습니다.  <br/>

<br/>  

---

<br/>


#### 터널링

`BAS`에는 위에서 설명한 본인 확인 기능과 함께 `터널링`이란 개념을 사용해 패킷을 운반하는 기능이 있습니다. <br/> 
터널링은 소켓과 소켓 사이를 연결하는 TCP의 커넥션(연결 장치)과 비슷한데, 한쪽 출입구(소켓)에서 데이터를 넣으면 데이터가 그 모습 그대로 반대쪽 출입구(소켓)에 도달합니다.  <br/>
네트워크 내에 터널을 만들어 그 속을 패킷이 통과하는 식입니다.<br/>
<br/>
이 개념을 사용하여 BAS와 프로바이더의 라우터 사이에 있는 ADSL/FTTH 접속 서비스 사업자의 네트워크 안에 터널을 만듭니다. 그리고 여기에 사용자와 BAS를 연결하는 액세스 회선을 연결하면 사용자로부터 프로바이더의 라우터까지 한 개의 길이 만들어져서 패킷이 그 길을 통해 인터넷의 내부로 들어가는 형태가 됩니다.  <br/>
즉, 사용자의 액세스 회선이 프로바이더의 라우터까지 연장되는 개념입니다.<br/>
<br/>
터널링은 `TCP 커넥션`과 `캡슐화`를 이용한 방법이 있는데, TCP의 커넥션의 경우 먼저 네트워크에 설치한 터널링용 라우터(또는 터널링 기능이 있는 어떠한 것) 사이에 TCP의 커넥션을 만듭니다. <br/>
그리고 커넥션의 양 끝에 있는 소켓에 해당하는 부분을 라우터의 포트로 간주하고 여기에서 패킷을 송수신합니다.  <br/>
다른 방법인 캡슐화의 경우 헤더를 포함한 패킷 전체를 별도의 패킷 안에 저장하여 터널을 통과시키는 방식입니다.<br/>
<br/>

---
<br/>

#### 액세스 회선 전체 동작

액세스 회선의 동작은 사용자 측에 인터넷 접속용 라우터를 설치하여 인터넷에 접속하는 곳부터 시작됩니다.  <br/>
먼저 `인터넷 접속용 라우터(또는 PC)`에 프로바이더가 할당한 사용자 명과 패스워드를 등록하면 인터넷 접속용 라우터는 `PPPoE의 Discovery`라는 구조(ARP와 같이 인터넷의 브로드 캐스트를 이용)에 따라 `BAS`의 `MAC 주소`를 찾습니다.<br/>
<br/>
BAS의 MAC 주소를 찾으면 본인 확인이나 설정 값 통지 동작을 실행하기 위해 사용자명과 패스워드를 전송하는데, 이때 패스워드의 암호화 여부에 따라 `CHAP(Challenge HandShake Authentication Protocol)`과 `PAP(Password Authentication Protocol)`로 나뉘며 인터넷 접속용 라우터(또는 PC)의 설정을 통해 어떤 방법을 사용할지 선택합니다.<br/>
<br/>
암호화를 하는 CHAP가 더 권장되긴 하지만 패스워드는 BAS와 인터넷 접속용 라우터(또는 PC) 사이만 흐르므로 물리적으로 케이블에서 누설되는 전자파를 읽지 않고는 도청할 수 없으며 광섬유를 이용한 경우는 이마저도 불가능합니다.<br/>
<br/>
인증을 마친 이후 BAS는 사용자에 대해 TCP/IP 설정 정보를 통지하는데 여기에는 인터넷에 접속하는 기기에 할당한 IP 주소, DNS 서버의 IP 주소, 기본 게이트웨이의 IP 주소가 포함됩니다.  <br/>
인터넷 접속용 라우터를 사용할 경우 이 정보를 받아 BAS 측 포트에 글로벌 주소를 할당하고 경로표에 기본 게이트웨이를 설정하는 등 라우터 자체에 설정합니다.  <br/>
이로써 인터넷에 패킷을 중계할 수 있는 상태가 됩니다.<br/>
<br/>
하지만 이때 라우터에서 설정 정보를 받아 글로벌 주소를 할당하면 PC에서는 글로벌 주소를 사용할 수 없습니다.<br/>
이 경우 `PC`에서는 `프라이빗 주소`를 할당하고 PC가 보낸 패킷은 인터넷 접속용 라우터에서 주소 변환 후 인터넷에 중계되는데, 애플리케이션에 따라 지원되지 않는 경우가 있습니다.<br/>
<br/>
이럴 땐 라우터를 사용하지 않고 BAS가 통지하는 PPPoE의 메시지를 PC가 받는 형태로 인터넷에 직접 연결해야 합니다.  <br/>
하지만 이 경우에도 글로벌 주소가 직접 할당되어 인터넷으로부터 패킷이 직접 도착하기 때문에 보안 대책을 세우는 것이 좋습니다.<br/>
<br/>
패킷 송수신 준비가 끝난 이후 누군가 브라우저에서 인터넷에 액세스 하면 패킷이 흘러 들어오는데 이 패킷의 수신처는 인터넷의 어느 한 부분으로 인터넷 접속용 라우터의 경로표에는 등록되어 있지 않을 겁니다.  <br/>
이 경우 기본적인 라우터의 중계 방식대로 기본 게이트웨이로 중계됩니다.<br/>
<br/>
중계 대상이 정해지면 패킷을 송신하는데 이 방법은 인터넷이 아닌 `PPPoE 사양`을 따릅니다.  <br/>
먼저 송신하는 패킷에 `MAC헤더`, `PPPoE헤더`, `PPP 헤더`를 `IP헤더`, `TCP헤더`와 `데이터` 앞에 붙입니다.  <br/>
<br/>
MAC 헤더의 수신처 주소에는 PPPoE의 Discovery에서 조사한 BAS의 MAC 주소를, 송신처 주소에는 라우터의 BAS 측 포트의 MAC 주소를, 그리고 이더 타입에는 PPPoE를 나타내는 8864(16진수)를 작성합니다.  <br/>
PPPoE와 PPP 헤더에는 페이로드 이외에는 모두 사전에 정해진 값이 들어갑니다.<br/>
<br/>
이렇게 준비된 패킷은 BAS에 도착하여 MAC 헤더와 PPPoE헤더가 제거되고 PPP 이후 부분이 추출되어 터널링을 통해 프로바이더의 라우터로 터널을 이용해 송신됩니다.<br/>
<br/>
`PPPoE`가 동작하는 데 있어서 부가되는 헤더의 대부분의 값은 사전에 결정되어 있어서 경로표의 기본 게이트웨이 항목에 어떤 값이 들어와도 관계가 없다는 성질이 있습니다.  <br/>
즉, 라우터의 포트끼리 하나의 케이블로 연결되어 있을 경우 중계 대상의 주소를 조사할 필요가 없기 때문에 글로벌 주소가 부족할 경우에 대한 특례로 `1:1 접속 형태`에서는 포트에 IP 주소를 할당하지 않아도 상관없도록 되었고, 이제는 이것이 통례가 되었습니다.  <br/>
이것을 `unnumbered`라고 하며 이 경우 BAS에서 설정 정보를 통지할 때 기본 게이트웨이의 IP 주소를 통지하지 않습니다.<br/>
<br/>

---
